• q ∈ Ai

• q ∈ Sm such that there exist p ∈ Ci ∩ Sm (notation from Lemma 4)

First two cases are straightforward. To prove the theorem for the third case observe that if q /∈ Qi∪Ai, then q /∈ Aj and q /∈ Qk for any j, k 6= i otherwise B would be non-deterministic. So we deduce that q ∈ Sm for somem. For the sake mb of contradiction suppose that Ci ∩ Sm = ∅. But that means, that q.a ∈ Bj for j 6= i and further q.abmw′ = q.w = qjl what is a contradiction. From these considerations we are able to determine for each i the sets Ai and Qi that are ′ ′ subsets of the set Q′i. In order to compute the sets Ci we first compute S .., S 1, n inducing all a-clusters in B by removing b, 0, 1 transitions and determine all connected components of the resulting structure. Now we examine three cases for a cluster S′j :

• S′j ∩ Q̄i = ∅

• S′j ⊆ Q̄i

′ 6⊂ Q̄i

• S′j ∩ Q̄i 6= ∅ and S j

Notice, that if the first case holds we know that no state of S′j belongs to Ci. If the second case holds, we must check if S′j ⊆ Qi ∪Ai. If this is not true, then we have found a cluster Cm, such that for all q ∈ Km it holds ρ(q, b) ∈ Bi and we determined the a-cluster that belongs to Ci. In the third case we know that some of the states of the cluster S′j are in Ci and some are not. To compute ′ those that are let us take the center of the a-cluster S′j , say K , and observe j ′ ′′ that q ∈ Ci if, and only if q ∈ {p ∈ K : ρ(p, b) ∈ Bi} = K or q belongs to j j ′′j some branch with destination in K . That concludes the proof.

Using two former lemmas, decryption method is similar as in 4. Extended step is depicted on Figure 7. If we choose the public key to be the automaton on Figure 2, then notice, that in Lemma 4 we have m = 2, and Q.a2b = {2, 3, 7, 12, 13}.

13