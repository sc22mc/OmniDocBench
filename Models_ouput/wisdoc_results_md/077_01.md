Timewarp: Transferable Acceleration of Molecular Dynamics by

Learning Time-Coarsened Dynamics

* † 1 2 Leon Klein * † 3

Andrew Y. K. Foong Tor Erlend Fjelde †

Sebastian Nowozin Frank Noé * † 3 Bruno Mlodozeniec Ryota Tomioka † Marc Brockschmidt

Abstract

Molecular dynamics (MD) simulation is a widely used technique to simulate molecular systems, most commonly at the all-atom resolution where the equations of motion are integrated with timesteps on the order of femtoseconds (1fs =

MD is often used to compute equilib- 10−15s). rium properties, which requires sampling from an equilibrium distribution such as the Boltz- mann distribution. However, many important pro- cesses, such as binding and folding, occur over timescales of milliseconds or beyond, and can- not be efficiently sampled with conventional MD. Furthermore, new MD simulations need to be per- formed from scratch for each molecular system studied. We present Timewarp, an enhanced sam- pling method which uses a normalising flow as a proposal distribution in a Markov chain Monte Carlo method targeting the Boltzmann distribu- tion. The flow is trained offline onMD trajectories and learns to make large steps in time, simulating the molecular dynamics of 105−106 fs. Crucially, Timewarp is transferable between molecular sys- tems: once trained, we show that it generalises to unseen small peptides (2-4 amino acids), ex- ploring their metastable states and providing wall- clock acceleration when sampling compared to standard MD. Our method constitutes an impor- tant step towards developing general, transferable algorithms for accelerating MD.

1. Introduction

Molecular dynamics (MD) is a well-established technique for simulating physical systems at the atomic level. When performed accurately, it provides unrivalled insight into

*Equal †Work contribution done while at Microsoft Re- 1Microsoft 2Freie search Research AI4Science Universität Berlin 3University 4Rice of Cambridge University. Correspondence to: Ryota Tomioka <ryoto@microsoft.com>.

Preprint.

Figure 1. Initial state x(t) (Left) and accepted proposal state x(t+ τ) ∼ pθ(x(t+ τ)|x(t)) (Right) sampled from Timewarp for the tetrapeptide LAKS (not in trainset). The proposed state undergoes a large conformational change relative to the initial state, traversing from one metastable state to another.

the detailed mechanics of molecular motion, without the need for wet lab experiments. MD simulations have been used to understand processes of central interest in molec- ular biophysics, such as protein folding (Noé et al., 2009; Lindorff-Larsen et al., 2011), protein-ligand binding (Buch et al., 2011), and protein-protein association (Plattner et al., 2017). Many crucial applications of MD boil down to effi- ciently sampling from the Boltzmann distribution, i.e., the equilibrium distribution of a molecular system at a tempera- ture T . Let (xp(t), xv(t)) := x(t) ∈ R6N be the state of the molecule at time t, consisting of the positions xp(t) ∈ R3N and velocities xv(t) ∈ R3N of the N atoms in Cartesian coordinates. The Boltzmann distribution is given by:

$$
\begin{array}{r}{\textstyle\mu(x^{p},x^{v})\propto\exp\left(-\frac{1}{k_{B}T}(U(x^{p})+K(x^{v}))\right),}\end{array}
$$

(1)

where U(xp) is the potential energy, K(xv) is the kinetic energy, and kB is Boltzmann’s constant. In practice we are interested in the marginal distribution of the positions, µ(xp). Many important quantities, such as the free energies associated with protein folding and protein-ligand binding, can be computed as expectations under µ(xp).

A popular method in MD to sample from the Boltzmann distribution is Langevin dynamics (Langevin, 1908), which √ obeys the following stochastic differential equation (SDE):

$$
m_{i}\mathrm{d}x_{i}^{v}=-\nabla_{i}U\mathrm{d}t-\gamma m_{i}x_{i}^{v}\mathrm{d}t+\sqrt{2m_{i}\gamma k_{B}T}\mathrm{d}B_{t}.
$$

(2)

arXiv:2302.01170v1 [stat.ML] 2 Feb 2023