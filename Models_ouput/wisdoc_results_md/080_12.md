5.1 Extended encryption

The extension consists of adding two stages between the 1 and 2 stage of en- cryption method, defining sets Q′i and substitute them for Qi in latter stages. Let us state two additional stages:

1. add l a-clusters with depth 1 to automaton obtained in stage 1 and define letters b for centers of those clusters to fulfill assumptions of lemma 4 in ρ function (defined in section 3)

2. for each copy Ai of public key in automaton obtained in previous stage add ki states and define transitions as in lemma 3 and note the set of the added states in this stage as Ai for each Ai

Now let us define sets Q′i. For clusters C1 = (S1, {a}, γ1), . . . , Cl = (Sl, {a}, γl) (from stage 1) with centersK1, . . . ,Kl respectively we define sets C1, . . . , C|u|+1, such that if for q ∈ Ki it holds ρ(q, b) ∈ Bj (notation from lemma 4), then q ′ and its branch belong to the set Cj . Then define Q = Qi ∪ Ai ∪ Ci. It i ′ is a simple exercise to prove that the sets Q′1, . . . , Q form a partition of |u|+1 ⋃|u|+1 P = Qi ∪ Ai ∪ Ci which is the set of all states of our ciphertext. The i=1 latter stages remain as in section 3.

5.2 Extended decryption

Algorithm of deciphering is similar to the one described in section 4. We state lemmas being in a strict correspondence with those proven in section 4.

Lemma 5. Let B be a ciphertext computed by extended encryption method using public key A = (Q,Σ, δ) and Q.w = ql. After removing letters x ∈ {0, 1} from |u|+1 2 automaton B we have that P.w = {q1l , q , . . . , q }. l l

Proof. Observe that after stage 1 we can apply Lemma 4 and we obtain that ⋃|u|+1 |u|+1 1 2 Qi ∪ Ci).w = {q , q , .., q }. Notice that after stage 2 we can apply i=1 l l l

Lemma 3 to any copy of public key that was modified by that stage and also |u|+1 2 P.w = {q1l , q , .., q }. The rest of the proof is similar to the proof of Lemma l l 1.

Lemma 6. There exist an algorithm with polynomial time complexity (depend- ′ ′ ing on |P | and |w|) which computes a partition of P on sets Q′1, Q ..., Q 2, |u|+1.

Proof. Using approach from the proof of Lemma 2 we can compute similar matrix, say M , in time O(|P ||w|). From Lemma 6 we know the last row con- |u|+1 2 tains only the states from the set {q1l , q , . . . , q } and we can compute sets l l

Q̄1, . . . , Q̄|u|+1 such if column of the first row containing q is the same as the column of the last row containing qil , then q ∈ Q̄i. Notice that there are three cases, when q ∈ Q̄i:

• q ∈ Qi