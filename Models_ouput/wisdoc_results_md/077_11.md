Timewarp: Transferable Acceleration of Molecular Dynamics by Learning Time-Coarsened Dynamics

A. Symmetries of the architecture A.1. Proof of Proposition 4.1

In this appendix we provide more details on the equivariance of the Timewarp architecture. We first prove Proposition 4.1 from the main body:

Proof. LetX(t+τ)x(t) denote the random variable obtained by sampling Z ∼ p(z) and computingX(t+τ) := f(Z;x(t)). Here we subscript X(t+ τ)x(t) by x(t) to emphasize that this is the random variable obtained when conditioning the flow on x(t). We first note that the equivariance condition on the densities p(σx(t+ τ)|σx(t)) = p(x(t+ τ)|x(t)) is equivalent to the following constraint on the random variables:

$$
X(t+\tau)_{\sigma x(t)}\overset{d}{=}\sigma X(t+\tau)_{x(t)},
$$

(20)

d= where denotes equality in distribution. To see this, let pX denote the density of the random variable X . Then, in terms of densities, Equation (20) is equivalent to stating that, for all x,

$$
\begin{array}{r}{p_{X(t+\tau)_{\sigma x(t)}}(x)=p_{\sigma X(t+\tau)_{x(t)}}(x)\qquad\qquad\qquad}\\ {=p_{X(t+\tau)_{x(t)}}(\sigma^{-1}x),}\end{array}
$$

(21) (22)

where in Equation (22) we used the change-of-variables formula, along with the fact that the group actions we consider (rotations, translations, permutations) have unit absolute Jacobian determinant. Redefining x← σx, we get that for all x,

$$
p_{X(t+\tau)_{\sigma x(t)}}(\sigma x)=p_{X(t+\tau)_{\sigma x(t)}}(x).
$$

(23)

Recalling the notation thatX(t+ τ)x(t) is interpreted as the random variable obtained by conditioning the flow on x(t), this can be written as

$$
p(\sigma x|\sigma x(t))=p(x|x(t))
$$

(24)

which is exactly the equivariance condition stated in terms of densities above. Having rephrased the equivariance condition in terms of random variables in Equation (20), the proof of Proposition 4.1 is straightforward.

$$
{\begin{array}{l}{X(t+\tau)_{\sigma x(t)}:=f(Z,\sigma x(t))}\\ {={\overset{d}{=}}f(\sigma Z,\sigma x(t))}\\ {=\sigma f(Z,x(t))}\\ {:=\sigma X(t+\tau)_{x(t)},}\end{array}}
$$

(25)

(26) (27) (28)

where in Equation (26) we used the fact that the base distribution p(z) is σ-invariant.

A.2. Translation equivariance via canonicalisation

We now describe the canonicalisation technique used to make our models translation equivariant. Let q(xp(t+ τ), xv(t+

We can make it τ)|xp(t)) be an arbitrary conditional density model, which is not necessarily translation equivariant. translation equivariant in the following way. Let xp denote the average position of the atoms, ∑

$$
{\overline{{x^{p}}}}:={\frac{1}{N}}\sum_{i=1}^{N}x_{i}^{p}.
$$

(29)

Then we define

$$
p(x^{p}(t+\tau),x^{v}(t+\tau)|x^{p}(t)):=q(x^{p}(t+\tau)-{\overline{{x^{p}(t)}}},x^{v}(t+\tau)|x^{p}(t)-{\overline{{x^{p}(t)}}})
$$

(30)

where the subtraction of xp(t) is broadcasted over all atoms. We now consider the effect of translating both xp(t) and xp(t+ τ) by the same amount. Let a be a translation vector in R3. Then

$$
{\begin{array}{rl}&{p(x^{p}(t+\tau)+a\cdot x^{v}(\d t-\tau)|x^{p}(t)+a\rangle={\overline{{q(x^{v}(t+\tau)+a)}}},x^{v}(t+\tau)|x^{p}(t)+a-{\overline{{(x^{p}(t)+a)}}},x^{v}(t+\tau)|x^{p}(t)+a-{\overline{{(x^{v}(t)+a)}}})}\\ &{\qquad=q{\big(}x^{v}(t+\tau)+a\setminus{\overline{{x^{p}(t)}}}-u,x^{v}(t+\tau)|x^{p}(t)+a-{\overline{{x^{p}(t)}}}-a{\big)}}\\ &{\qquad=q(x^{v}(t+\tau)-{\overline{{x^{p}(t)}}},x^{v}(t+\tau)|x^{p}(t)-{\overline{{x^{v}(t)}}})}\\ &{\qquad={\textit{p}}(x^{p}(t+\tau),x^{v}(t+\tau)|x^{p}(t)).}\end{array}}
$$

(31) (32) (33) (34)