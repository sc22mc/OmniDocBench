IEEE TRANSACTIONS ON AGRIFOOD ELECTRONICS, VOL. 2, NO. 2, SEPTEMBER/OCTOBER 2024

Fig. 7. Bode plots of the inactive PMFC obtained with the MAX30134 on the third day of tests, compared with the results obtained with the Autolab PGSTAT302 N.

Fig. 8. Bode plots of the active PMFC obtained with the MAX30134 on the third day of tests, compared with the results obtained with the Autolab PGSTAT302 N.

Fig. 9. Complete EIS measurement power profile with removed static con- sumption. On the top left, initial operations are displayed: turn ON, register load, and OCV measurement consumption. On the top right, we can see a detail of the turn-OFF peak.

E. Energy Consumption Estimation

The energy storage must be able to sustain node operation during its most energy-consuming, uninterruptible task. In this application, both EIS measurement sweep and data transmis- sion/reception events are to be executed without interruption. We estimate the most energy-consuming task between the two and dimension the energy storage accordingly. The current draw for the sensor nodeSCand components in the different execution states (pictured in Fig. 2) are reported in Table II.

1) EIS Measurement Consumption: We evaluate the power consumption of the MAX30134 during a typical EIS measure- ment sweep, equal to the one used in the previous section. The sweep takes TEIS,AFE =722.2 s andEEIS,AFE =1.53 J. Moreover,

TABLE III

CONTENTS OF THE LORA MESSAGE

\begin{tabular}{lll} Field & Message content & Bytes \\ \midrule Node ID & ``N'' + node ID & 3 \\ Timestamp & ``T'' + timestamp & 5 \\ 19 impedance values & ``R'' + real part + ``I'' + imaginary part & 114 \end{tabular}

the MSP430FR5959 consumes IMCU,FRAM ON = 103 µA/MHz if FRAM is active, IMCU,FRAM OFF = 65 µA/MHz if FRAM is inactive.3 The inactive mode can be used if FRAM access is not required for some time; short tasks can be executed from RAM. Assuming we can run EIS sweep task without accessing FRAM memory, that we run the MCU at 16 MHz (to produce the 8 MHz SPI clock needed to drive the MAX30134) and that we supply the MCU with an average VDD,MCU = 2.8 V (halfway between VMIN and VMAX), the energy required to run theMCUwith FRAMoff for a time tEIS,AFE at fCLK = 16MHzis EEISMCU = 2.11 J.We also consider the energy consumption of the BQ, the voltage monitors and the other SC active during EIS, consuming a total of 1 mJ (see Table II). Moreover, snapshot and restore operations to/from FRAM needed for intermittent operation require an energy overhead of ERST = 8.29 µJ and ESN = 7.83 µJ, respectively.

Summing all the energy contributions, we obtain EEIS = 3.64 J. It is worth noting that most of this energy is consumed by the MCU, which must be kept active during all the SPI transactions. As the power consumption of an MCU is directly linked to the clock frequency, in order to minimize the energy demand, we lower the main clock frequency to the minimum acceptable frequency for theSPI to complywith theMAX30134. In this case, we set the MCLK to 16 MHz in order to generate a SPI clock of 8 MHz, the minimum frequency required by the MAX30134 SPI interface. EIS measurement consumption can mostly be reduced by increasing the minimum EIS frequency point to be studied, as sub-Hz frequency points take a long time to execute.

2) LoRa Message Consumption: We rely on the LoRa transceiver Semtech SX1276 to transmit EIS measurement data to a gateway. The information coming from each 19-point EIS sweep can be packed into a 122-byte LoRa message (see Ta- ble III). Transmitting EIS data packet at SF7 and 250 kHz, we obtain a minimum airtime of tairtime = 112.8 ms.4

Transmitting at minimum power (2 dBm) draws ITX = 22.54 mA. This value leave us with ETXLoRa = 7.11 mJ. The chosen radio chip requires to be piloted through 8MHzSPI, such as the MAX30134 chip, thus it accounts for ELoRaMCU = 0.33 mJ. We also add the consumption of the active BQ, the two voltage monitors and the SC active during the TX phase, amounting to 0.15 µJ (see Table II) Summing these contributions together, along with a snapshot, a restore event, we obtainETX = 7.4mJ.

We thus conclude that the EIS measurement is the most energy-consuming, uninterruptible operation foreseen by the

3[Datasheet] MSP430FR596x, MSP430FR594x Mixed-Signal Microcon- trollers, Texas Instruments, 10 2012, rev August 2018.

4Lora airtime calculator. [Online]. Available: https://www.thethingsnetwork. org/airtime-calculator