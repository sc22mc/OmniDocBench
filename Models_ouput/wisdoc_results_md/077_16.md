Timewarp: Transferable Acceleration of Molecular Dynamics by Learning Time-Coarsened Dynamics

Figure 13. Validation of new metastable states found with Timewarp exploration. The red crosses indicate the different conditioning states. (a) TICA plots for (not conditional) samples generated via a long MD trajectory, Timewarp exploration (Algorithm 2), and Timewarp MCMC (Algorithm 1). Timewarp exploration discovers some metastable states unseen in the long MD trajectories (bottom of LYVI plot, bottom left of CTSA plot). (b) Conditional distributions generated with MD or with the Timewarp model, starting from states visited by the longMD trajectory shown in (a). Some short MD trajectories now discover the new metastable states, verifying that they are indeed valid states. Only the final state of each short MD trajectory is recorded. (c) Conditional distributions generated with MD or with the Timewarp model, starting from the new metastable states discovered by one of the short MD trajectories shown in (b).

B.5. Exploration of new metastable states

For some tetrapetides in the test set even long MD trajectories (1µs) miss some metastable states, e.g. for LYVI and CSTA shown in Figure 13a. However, we can easily explore these with the Timewarp exploration algorithm (Algorithm 2). To confirm that these additional metastable states are in fact stable, we run several shorter MD trajectories (0.5× 106fs), in the same way as in Appendix B.3, starting in a nearby metastable state already discovered with the long MD trajectory (Figure 13b). Once one of them hits the new, previously undiscovered state, we start new short MD trajectories (0.5× 106fs) from there as well (Figure 13c). These new short MD trajectories either sample within this previously undiscovered state, or transition to the other metastable states. This shows that this metastable state discovered by Timewarp exploration is indeed valid, and was simply undiscovered during the long MD trajectory. In addition, we compare in Figure 13 the conditional MD distributions with that of Timewarp, again showing close agreement.

C. Exploration of metastable states using Timewarp without MH corrections

We describe the exploration algorithm for Timewarp, which accepts all proposed states unless the energy is above a certain cutoff value. As there is no MH correction, the generated samples will not asymptotically follow the Boltzmann distribution, but the exploration of the state space is much faster than with MD or Algorithm 1. The pseudocode is shown in Algorithm 2:

Algorithm 2 Fast exploration of the state space with Timewarp

Require: Initial state Xp0 , number of stepsM , maximum allowed energy increase∆Umax form = 0, . . . ,M do

Sample X̃pm ∼ pθ(· | Xpm) {Sample from conditional flow} if U(X̃pm)− U(Xpm) < ∆Umax then Xpm+1 ← X̃pm else Xpm+1 ← Xpm {Reject if energy change is too high} end if end for p output Xp0 , . . . X M

Note that unlike Algorithm 1, there is no need for the auxiliary variables, since the conditional flow only depends on the positions, and no MH acceptance ratio is computed here. The potential energy U includes here also a large penalty if the ordering of a chirality center changes as described in Appendix A.3. As sampling proposals from Timewarp can be batched, we can generate B chains in parallel, all starting from the same initial state. This batched sampling procedure leads to even further speedups. For all exploration experiments we use a batch size of 100, and runM = 10000 exploration steps. The maximum allowed energy change cutoff is set at∆Umax = 300kJ/mol.