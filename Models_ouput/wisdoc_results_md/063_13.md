CERTAIN DIAGONAL EQUATIONS AND CONFLICT-AVOIDING CODES OF PRIME LENGTHS 13

By omitting pairs ( j,k) of I× I satisfying j+ k = ℓ, Lemma 3.4 gives that

$$
\mathcal{N}-\boldsymbol{\mathcal{P}}(\ell)(\boldsymbol{q}+1)=\sum_{d|\ell}\sum_{\underset{(t,\frac{\ell}{d})=1}{1\leq t\leq\frac{\ell}{d}},\;(j,k)\in\mathcal{S}(d,t)}\boldsymbol{\mathcal{X}}(-1)^{j+k}\boldsymbol{J}(\boldsymbol{\mathcal{X}}^{j},\boldsymbol{\mathcal{X}}^{k})c_{\ell}(2\boldsymbol{j}+\boldsymbol{k}).
$$

For ( j,k) ∈ S′(d, t), one has (2 j+ k, ℓ) = d and then cℓ(2 j+ k) = cℓ(d) by Corollary 3.3. Thus,

$$
N-\boldsymbol{\phi}(\ell)(q+1)=\sum_{d|\ell}c_{\ell}(d)f(d)
$$

where

$$
f(d)=\sum_{1\leq t\leq\frac{\ell}{d},\atop(t,\frac{\ell}{d}=1)}\sum_{(j,k)\in\mathcal{S}^{\prime}(d,I)}\pmb{\chi}(-1)^{j+k}\pmb{J}(\pmb{\chi}^{j},\pmb{\chi}^{k}).
$$

We need to estimate | f (d)|. j,χk)|= By definition, every pair ( j,k) of S′(d, t) satisfies j+k 6≡ 0 (mod ℓ) and thus |J(χ √

q by (v) of Lemma 2.2. Since |χ(−1)|= 1, it follows that

$$
|f(\boldsymbol{d})|\le\sum_{\substack{1\le t\le\frac{\ell}{7},\\(\ell,\frac{\ell}{d})=1}}|S^{\prime}(\boldsymbol{d},t)|\sqrt{q}.
$$

Now, we compute |S′(d, t)|. Observe that every pair ( j,k) in S′(d, t) is determined by j ∈ I with the proviso that j+ k 6= ℓ. Thus, for ( j,k) ∈ I× I satisfying the congruence 2 j+ k ≡ td (mod ℓ) we have to exclude the pair ( j,k) with j ≡ td (mod ℓ). Note that td ≤ ℓ while j ≤ ℓ−1, this congruence can occur only when d  ℓ and j = td. Moreover, as k 6= 0, we also need to exclude the case where 2 j ≡ td (mod ℓ). This depends on the parity of ℓ. We discuss in the next paragraph to steer clear of confusing.

Suppose that ℓ is odd. Let s ∈ I be such that 2s≡ 1 (mod ℓ). Then, we need to exclude j ∈ I such that j ≡ std (mod ℓ). If d = ℓ, then there is no such j because j 6≡ 0 (mod ℓ). When d  ℓ, there is exactly one j0 ∈ I satisfying j0 ≡ std (mod ℓ). Remember that we also have to exclude the case where j = td. As a consequence, if ℓ is odd, then

$$
|S^{\prime}(d,t)|=\left\{\begin{array}{ll}{{|I|}}&{{{\textrm{if}}\;d=\ell;}}\\ {{|I|-2}}&{{{\textrm{if}}\;d\neq\ell.}}\end{array}\right.
$$

Now we assume that ℓ is even. There are three cases to consider: (i) td is odd, (ii) td is even and d  ℓ and (iii) t = 1,d = ℓ. For case (i), since td is odd, there is no j such that 2 j ≡ td (mod ℓ). Only the case where j = td has to be excluded. For (ii) and (iii), we have that td is even and then there is some j1 ∈ I such that 2 j1 ≡ td (mod ℓ). In fact, td2 ℓ2).

td2 td2 ℓ2 we have j1 ≡ (mod If d  ℓ, then either j1 = or j1 = + and in particular, ℓ2 j1 6= td in this case. If d = ℓ, then t = 1 and j1 = . We conclude that  Combining these two situations of ℓ, we have an expression for |S′(d, t)| as follows. ⌊ ⌋ ⌊ ⌋

$$
|S^{\prime}(\boldsymbol{d},t)|=\left\{\begin{array}{ll}{|I|-1}&{\textrm{if}\;\boldsymbol{d}=\ell;}\\ {|I|-1}&{\textrm{if}\;\boldsymbol{d}\neq\ell\;\textrm{and}\;\boldsymbol{t}\boldsymbol{d}\;\textrm{is~odd};}\\ {|I|-3}&{\textrm{otherwise.}}\end{array}\right.
$$