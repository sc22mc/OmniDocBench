![](images/474c19676f2c423e41fca0ad7d5b38f4bdaec68f863bc3d49feb58a6f58cd046.jpg)  
Potentiostat vsMAX30134:Magnitude,inactive PMFC   
Fig.7.Bode plots of the inactive PMFC obtained with the MAX30134 on the third day of tests,compared with the results obtained with the Autolab PGSTAT302 N.

![](images/f9a561b369b1b049ec05a76a46508dd76ede63336f288b32d2c11cc205ecfd12.jpg)  
Fig.8．Bode plots of the active PMFC obtained with the MAX30134 on the third day of tests,compared with the results obtained with the Autolab PGSTAT302 N.

![](images/e81d4b127bdbb123c8f1c45010f153e88c7004100b9350eb7d127ec4e038fd94.jpg)  
Fig.9.Complete EIS measurement power profile with removed static consumption.On the top left,initial operations are displayed:turn ON,registerload, and OCV measurement consumption. On the top right,we can see a detail of the turn-OFF peak.

# E.Energy Consumption Estimation

The energy storage must be able to sustain node operation during its most energy-consuming,uninterruptible task.In this application,both EIS measurement sweep and data transmission/reception events are to be executed without interruption. We estimate the most energy-consuming task between the two and dimension the energy storage accordingly. The current draw for the sensor node SC and components in the different execution states (pictured in Fig.2) are reported in Table II.

TABLEIII CONTENTS OFTHE LORA MESSAGE   

<table><tr><td>Field</td><td>Message content</td><td>Bytes</td></tr><tr><td>NodeID</td><td>“N&quot;+ node ID</td><td>3</td></tr><tr><td>Timestamp</td><td>“T”+ timestamp</td><td>5</td></tr><tr><td>19 impedance values</td><td>“R”+ real part +“I”+imaginary part</td><td>114</td></tr></table>

1）EIS Measurement Consumption:We evaluate the power consumption of the MAX30134 during a typical EIS measurement sweep,equal to the one used in the previous section. The sweep takes $T _ { \mathrm { E I S , A F E } } = 7 2 2 . 2$ sand $E _ { \mathrm { E I S , A F E } } = 1 . 5 3 \mathrm { J }$ Moreover, the MSP430FR5959 consumes $I _ { \mathrm { M C U , F R A M O N } } = 1 0 3$ $\mu { \mathrm { A } } / { \mathrm { M H z } }$ if FRAM isactive, $I _ { \mathrm { M C U , F R A M O F F } } = 6 5$ $\mu \mathrm { A } / \mathrm { M H z }$ if FRAM is inactive.3 The inactive mode can be used if FRAM access is not required for some time; short tasks can be executed from RAM.Assuming we can run EIS sweep task without accessing FRAM memory, that we run the MCUat $1 6 \ \mathrm { M H z }$ (to produce the8MHz SPI clock needed to drive the MAX30134）and that we supply the MCU with an average $V _ { \mathrm { D D , M C U } } = 2 . 8 \ \mathrm { \Omega }$ (halfway between $V _ { \mathrm { M I N } }$ and $V _ { \mathrm { M A X } }$ ),the energyrequired torun theMCUwithFRAMoff for a time $t _ { \mathrm { E I S , A F E } }$ at $f _ { \mathrm { C L K } } = 1 6 \mathrm { M H z }$ is $E _ { \mathrm { M C U } } ^ { \mathrm { E I S } } = 2 . 1 1 \mathrm { J }$ Wealsoconsider the energyconsumption of the BQ, the voltage monitors and the other SC active during EIS, consuming a total of $1 \textrm { m J }$ (see Table II).Moreover, snapshot and restore operationsto/fromFRAM needed for intermittent operation require an energyoverhead of $E _ { \mathrm { R S T } } = 8 . 2 9 ~ \mu \mathrm { J }$ and $E _ { \mathrm { S N } } = 7 . 8 3 ~ \mu \mathrm { J }$ ,respectively.

Summing all the energy contributions,we obtain $E _ { \mathrm { E I S } } =$ $3 . 6 4 \mathrm { ~ J ~ }$ Itis worth noting that most of this energy is consumed bythe MCU,which must be kept active during all the SPI transactions.As the power consumption of an MCU is directly linked to the clock frequency, in order to minimize the energy demand,we lower the main clock frequency to the minimum acceptable frequency forthe SPIto comply with the MAX30134. In this case,we set the MCLK to $1 6 \ \mathrm { M H z }$ in order to generate a SPI clock of $8 \ \mathrm { M H z }$ ,the minimum frequency required by the MAX30134 SPI interface.EIS measurement consumption can mostly be reduced by increasing the minimum EIS frequency point to be studied,as sub-Hz frequency points take a long time to execute.

2）LoRa Message Consumption:We rely on the LoRa transceiver Semtech SX1276 to transmitEISmeasurementdata toa gateway.The information coming from each 19-point EIS sweep can be packed into a 122-byte LoRa message (see Table III). Transmitting EIS data packet at SF7 and $2 5 0 \mathrm { k H z }$ we obtain a minimum airtime of $t _ { \mathrm { a i r t i m e } } = 1 1 2 . 8 \mathrm { m s } .$ 4

$( 2 \ \mathrm { \ d B m } )$ $I _ { \mathrm { T X } } =$ $2 2 . 5 4 \mathrm { \ m A }$ $E _ { \mathrm { L o R a } } ^ { \mathrm { T X } } = 7 . 1 1 ~ \mathrm { m J }$ chosen radio chip requires to be piloted through 8 MHz SPI, such astheMAX30134chipthusitotsfor $E _ { \mathrm { M C U } } ^ { \mathrm { L o R a } } = 0 . 3 3 \ : \mathrm { m J }$ We also add the consumption of the active BQ,the two voltage monitors and the SC active during the TX phase,amounting to $0 . 1 5 ~ \mu \mathrm { J }$ (see Table II） Summing these contributions together, along with a snapshot,a restore event,we obtain $E _ { \mathrm { T X } } = 7 . 4 \ : \mathrm { m J }$

We thus conclude that the EIS measurement is the most energy-consuming，uninterruptible operation foreseen by the